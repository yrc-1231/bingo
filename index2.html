<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çŸ³ç«ç”µç« BINGOå•</title>
    <style>
        /* --- 1. åŸºç¡€è®¾ç½® --- */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: "Microsoft YaHei", "Heiti SC", sans-serif;
            user-select: none; 
        }

        body {
    background-color: #000;
    background-image: url('images/bg.png'); /* æ·»åŠ è¿™ä¸€è¡Œ */
    background-size: cover; /* æ·»åŠ è¿™ä¸€è¡Œ */
    background-position: center; /* æ·»åŠ è¿™ä¸€è¡Œ */
    background-repeat: no-repeat; /* æ·»åŠ è¿™ä¸€è¡Œ */
    background-attachment: fixed; /* æ·»åŠ è¿™ä¸€è¡Œ */
    color: white;
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
    padding: 10px;
    padding-bottom: 80px;
    position: relative;
}

/* ç„¶ååœ¨bodyæ ·å¼çš„åé¢æ·»åŠ è¿™ä¸ªä¼ªå…ƒç´  */
body::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.1);
    z-index: -1;
}

        /* é¡¶éƒ¨æ ‡é¢˜ */
        .header {
            margin: 10px 0 20px 0;
            text-align: center;
        }
        h1 {
            font-style: italic;
            color: #fff;
            text-shadow: 0 0 10px #ff0000;
            font-size: 32px;
            margin-bottom: 5px;
            letter-spacing: 2px;
        }
        .subtitle {
            color: #cc0000;
            font-size: 12px;
            letter-spacing: 5px;
            font-weight: bold;
        }

        /* --- 2. ç©æ³•æŒ‰é’®åŒºåŸŸ --- */
        .controls-area {
            width: 100%;
            max-width: 720px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px 15px;
            padding: 10px;
            background: rgba(20, 0, 0, 0.5);
            border: 1px solid #330000;
            margin-bottom: 20px;
        }

        .mode-btn {
            background: linear-gradient(90deg, #2b0000, #1a0000);
            border: 1px solid #550000;
            padding: 12px 10px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s;
        }

        .txt-left { font-size: 16px; font-weight: bold; color: #fff; text-shadow: 0 0 2px #000; }
        .txt-price { font-size: 14px; color: #ffcccc; margin-left: 5px; }
        .txt-right { font-size: 14px; display: flex; align-items: center; }
        .txt-bao { color: #aaa; font-size: 12px; margin-right: 5px; }
        .txt-val { color: #fff; font-weight: 900; font-size: 16px; background: #cc0000; padding: 0 4px; border-radius: 2px; }

        .mode-btn:hover { border-color: #ff4444; background: #330000; }
        .mode-btn.active {
            background: linear-gradient(90deg, #990000, #550000);
            border: 1px solid #ffaaaa;
            box-shadow: 0 0 15px rgba(255, 0, 0, 0.5);
            transform: scale(1.02);
            z-index: 2;
        }
        .mode-btn.active .txt-price { color: #fff; }
        .mode-btn.active .txt-val { background: #fff; color: #cc0000; }

        /* --- 3. 9x9 ç‰©å“ç½‘æ ¼ --- */
        .grid-wrapper {
            width: 100%;
            max-width: 720px;
            margin-bottom: 20px;
            border: 2px solid #330000;
            padding: 3px;
            background: #110000;
            box-shadow: 0 0 20px rgba(150, 0, 0, 0.2);
        }

        .grid-container {
            display: grid;
            grid-template-columns: repeat(9, 1fr);
            grid-template-rows: repeat(9, 1fr);
            gap: 2px;
            width: 100%;
            aspect-ratio: 1 / 1;
        }

        .cell {
            background-color: #0a0a0a;
            border: 1px solid #440000;
            position: relative;
            cursor: pointer;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .cell img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0.9;
            transition: 0.2s;
            display: block;
        }

        .cell span.fallback-num {
            position: absolute;
            color: #330;
            font-size: 12px;
            z-index: 1;
        }

        .cell.active {
            border: 1px solid #ff0000;
        }
        .cell.active img {
            opacity: 0.3;
            filter: grayscale(100%);
        }
        .cell.active::after {
            content: "âœ”";
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            color: #ff0000;
            font-size: 24px;
            font-weight: 900;
            text-shadow: 0 0 5px white;
            z-index: 10;
        }

        /* --- 4. åº•éƒ¨æ“ä½œæ  --- */
        .action-bar {
            width: 100%;
            max-width: 720px;
            margin-top: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px; /* ä¸ä¸‹æ–¹è§„åˆ™åŒºåŸŸæ‹‰å¼€è·ç¦» */
        }
        
        .mini-tip { color: #666; font-size: 12px; margin-bottom: 5px; }

        #resetBtn {
            background: #cc0000;
            color: white;
            border: none;
            padding: 12px 60px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 0 10px #ff0000;
            border-radius: 2px;
            width: 100%;
            max-width: 300px;
        }
        #resetBtn:active { transform: scale(0.95); }

        .system-btns {
            display: flex;
            gap: 10px;
            width: 100%;
            justify-content: center;
            flex-wrap: wrap;
        }

        .sys-btn {
            background: #1a1a1a;
            border: 1px solid #444;
            color: #aaa;
            padding: 8px 15px;
            font-size: 14px;
            cursor: pointer;
            border-radius: 4px;
            transition: 0.2s;
        }
        .sys-btn:hover {
            color: #fff;
            border-color: #fff;
            background: #333;
        }
        .sys-btn.file-op {
            border-color: #550000;
            color: #d4a5a5;
        }
        .sys-btn.file-op:hover {
            background: #330000;
            color: #fff;
            border-color: #ff0000;
        }

        #fileInput { display: none; }

        /* --- 5. æ–°å¢ï¼šè§„åˆ™è¯´æ˜åŒºåŸŸ --- */
        .rules-section {
            width: 100%;
            max-width: 720px;
            background: rgba(20, 0, 0, 0.4); /* æ·±çº¢åŠé€æ˜èƒŒæ™¯ */
            border: 1px dashed #440000;
            padding: 15px;
            margin-bottom: 40px; /* åº•éƒ¨ç•™ç™½ */
            border-radius: 4px;
        }

        .rules-title {
            color: #ff3333;
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 10px;
            text-align: center;
            border-bottom: 1px solid #330000;
            padding-bottom: 5px;
        }

        .rules-list {
            font-size: 18px;
            color: #ccc;
            line-height: 1.6;
            list-style-type: none; /* å»æ‰é»˜è®¤åœ†ç‚¹ */
        }

        .rules-list li {
            margin-bottom: 6px;
            padding-left: 10px;
            position: relative;
        }
        /* è‡ªå®šä¹‰å°çº¢ç‚¹ */
        .rules-list li::before {
            content: "â–ª";
            color: #cc0000;
            position: absolute;
            left: 0;
        }

        .highlight-gold {
            color: #ffcc00;
            font-weight: bold;
        }
        
        .special-note {
            margin-top: 10px;
            padding: 8px;
            background: rgba(255, 204, 0, 0.1);
            border: 1px solid rgba(255, 204, 0, 0.3);
            color: #ffddaa;
            font-size: 13px;
            text-align: center;
            border-radius: 4px;
        }

        /* --- 6. å¼¹çª— --- */
        #modal {
            display: none;
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        .modal-box {
            background: #1a0000;
            border: 2px solid #ff0000;
            padding: 40px;
            text-align: center;
            box-shadow: 0 0 60px #ff0000;
            min-width: 320px;
        }
        .modal-text {
            color: #fff;
            font-size: 20px;
            margin-bottom: 30px;
            font-weight: bold;
            line-height: 1.5;
        }
        .modal-btn {
            background: #ff0000;
            color: white;
            border: none;
            padding: 10px 30px;
            font-size: 16px;
            cursor: pointer;
            font-weight: bold;
        }

        /* --- 7. å³ä¸‹è§’æ ‡è¯† --- */
        .brand-info {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 100;
            text-align: right;
            background: rgba(0, 0, 0, 0.9);
            padding: 12px 15px;
            border-radius: 8px;
            border: 1px solid rgba(255, 204, 0, 0.4);
            box-shadow: 0 4px 15px rgba(0,0,0,0.6);
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
            line-height: 1.6;
            min-width: 180px;
        }

        .brand-info .highlight {
            color: #ffcc00;
            font-weight: bold;
            margin-left: 5px;
        }
        
        /* å¾®ä¿¡å°ç¨‹åºæŒ‰é’®æ ·å¼ */
        .brand-info .weapp-btn {
            margin-top: 10px;
            background: linear-gradient(135deg, #8b0000, #cc0000);
            color: #fff;
            border: 1px solid #ffcc00;
            padding: 8px 12px;
            font-size: 12px;
            cursor: pointer;
            border-radius: 4px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            transition: all 0.3s;
            width: 100%;
            text-decoration: none;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }
        
        .brand-info .weapp-btn:hover {
            background: linear-gradient(135deg, #cc0000, #ff3333);
            border-color: #ffdd44;
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(255, 0, 0, 0.4);
        }
        
        .brand-info .weapp-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }
        
        .brand-info .weapp-btn .weapp-icon {
            font-size: 14px;
        }
        
    </style>
</head>
<body>

    <div class="header">
        <h1>çŸ³ç«ç”µç«</h1>
        <div class="subtitle">BINGO MISSION</div>
    </div>

    <!-- ç©æ³•æŒ‰é’®åŒº -->
    <div class="controls-area">
        <div class="mode-btn active" data-mode="3" onclick="selectMode(3, this)">
            <div class="txt-left">3è¿ <span class="txt-price">999R</span></div>
            <div class="txt-right"><span class="txt-bao">ä¿</span><span class="txt-val">2288W</span></div>
        </div>

        <div class="mode-btn" data-mode="7" onclick="selectMode(7, this)">
            <div class="txt-left">7è¿ <span class="txt-price">5688R</span></div>
            <div class="txt-right"><span class="txt-bao">ä¿</span><span class="txt-val">8888W</span></div>
        </div>

        <div class="mode-btn" data-mode="4" onclick="selectMode(4, this)">
            <div class="txt-left">4è¿ <span class="txt-price">1388R</span></div>
            <div class="txt-right"><span class="txt-bao">ä¿</span><span class="txt-val">2888W</span></div>
        </div>

        <div class="mode-btn" data-mode="8" onclick="selectMode(8, this)">
            <div class="txt-left">8è¿ <span class="txt-price">9999R</span></div>
            <div class="txt-right"><span class="txt-bao">ä¿</span><span class="txt-val">1.5äº¿</span></div>
        </div>

        <div class="mode-btn" data-mode="5" onclick="selectMode(5, this)">
            <div class="txt-left">5è¿ <span class="txt-price">1888R</span></div>
            <div class="txt-right"><span class="txt-bao">ä¿</span><span class="txt-val">3488W</span></div>
        </div>

        <div class="mode-btn" data-mode="9" onclick="selectMode(9, this)">
            <div class="txt-left">9è¿ <span class="txt-price">11888R</span></div>
            <div class="txt-right"><span class="txt-bao">ä¿</span><span class="txt-val">2äº¿</span></div>
        </div>

        <div class="mode-btn" data-mode="6" onclick="selectMode(6, this)">
            <div class="txt-left">6è¿ <span class="txt-price">3288R</span></div>
            <div class="txt-right"><span class="txt-bao">ä¿</span><span class="txt-val">5588W</span></div>
        </div>
    </div>

    <!-- 9x9 ç½‘æ ¼ -->
    <div class="grid-wrapper">
        <div class="grid-container" id="grid"></div>
    </div>

    <!-- åº•éƒ¨åŠŸèƒ½åŒºåŸŸ -->
    <div class="action-bar">
        <div class="mini-tip">å½“å‰ç›®æ ‡ï¼š<span id="ruleText" style="color:#f00;font-weight:bold;">3</span> è¿</div>
        
        <button id="resetBtn" onclick="initGame()">é‡ç½®è®¢å•</button>

        <div class="system-btns">
            <button class="sys-btn file-op" onclick="exportDoc()">ğŸ’¾ å¯¼å‡ºæ–‡æ¡£</button>
            <button class="sys-btn file-op" onclick="triggerImport()">ğŸ“‚ å¯¼å…¥æ–‡æ¡£</button>
            <button class="sys-btn" onclick="goHome()">â†© è¿”å›ä¸»èœå•</button>
        </div>
        
        <input type="file" id="fileInput" accept=".json" onchange="handleFileLoad(event)">
    </div>

    <!-- â˜…â˜…â˜… æ–°å¢çš„è§„åˆ™æ–‡æœ¬åŒºåŸŸ â˜…â˜…â˜… -->
    <div class="rules-section">
        <div class="rules-title">ç©æ³•è§„åˆ™</div>
        <ul class="rules-list">
            <!-- çº æ­£ï¼šå°†"åš"æ”¹ä¸º"ç«–" -->
            <li>ä»»æ„ç«–æ¨ªæ–œè¿æˆçº¿å³ä¸ºç»“å•ï¼Œä¿åº•æ‰“å¤Ÿä¹Ÿå¿…é¡»è¿æˆçº¿æ‰èƒ½ç»“å•</li>
            <li>è¯¥ç©æ³•åœ°å›¾ç±»å‹ç”±é™ªç©é€‰æ‹©ï¼Œè€æ¿éœ€å¬ä»é™ªç©æŒ‡æŒ¥</li>
            <li>è¯¥ç©æ³•æ‘¸åˆ°çš„çº¢å¡è¿›ä¿é™©ä¹Ÿç®—è¿›åº¦ï¼Œè€æ¿ä¸å¯æ•…æ„ä¸å¡çº¢è¿›ä¿é™©</li>
            <li>å›¾ç‰‡ä¸­çš„é’¥åŒ™å¡åªåˆ†ä¸ºé‡‘å¡ã€çº¢å¡ã€ç´«å¡ä¸‰ç±»ï¼Œä¸ç‰¹å®šæŒ‡å®šæŸä¸ªé’¥åŒ™å¡</li>
            <li>åŒæ—¶æ¸¸æˆä¸­ï¼šçº¢å¡ä»·å€¼å¿…é¡»>200Wé‡‘å¡ä»·å€¼å¿…é¡»>100W</span></li>
            <li>å°äº100Wçš„é‡‘å¡ç®—ç´«å¡ï¼Œç´«å¡ä»·å€¼å¿…é¡»>50W</li>
            <li><span class="highlight-gold"> ç‰¹åˆ«æç¤ºï¼šéæ´²ä¹‹å¿ƒ / æµ·æ´‹ä¹‹æ³ª / å¤è‹å‘¼å¸æœº å¯ä»¥å½“ä¸‡èƒ½æ ¼å­</span></li>
        </ul>
    </div>

    <!-- å³ä¸‹è§’æ ‡è¯† - æ·»åŠ äº†å¾®ä¿¡å°ç¨‹åºæŒ‰é’® -->
    <div class="brand-info">
        <div class="kook">
            ğŸ§ KOOKï¼š<span class="highlight">6480</span>
        </div>
        <div class="mini-program">
            ğŸ“± æœåŠ¡å·/å°ç¨‹åº: <span class="highlight">çŸ³ç«ç”µç«</span>
        </div>
        <!-- æ–°å¢çš„å¾®ä¿¡å°ç¨‹åºæŒ‰é’® -->
        <button class="weapp-btn" onclick="openWeapp()">
            <span class="weapp-icon">ğŸ“±</span>
            <span>æ‰“å¼€å¾®ä¿¡å°ç¨‹åº</span>
        </button>
    </div>

    <!-- å¼¹çª— -->
    <div id="modal">
        <div class="modal-box">
            <div class="modal-text">æ‚¨å·²å®Œæˆè®¢å•<br>è®¢å•å·²ç»“æŸ</div>
            <button class="modal-btn" onclick="closeModal()">ç¡®å®š</button>
        </div>
    </div>

    <script>
        const gridEl = document.getElementById('grid');
        const ruleText = document.getElementById('ruleText');
        const modal = document.getElementById('modal');
        const fileInput = document.getElementById('fileInput');
        
        const GRID_SIZE = 9;
        let gridData = [];
        let currentTarget = 3;

        // åˆå§‹åŒ–å‡½æ•°
        function initGame(renderOnly = false) {
            gridEl.innerHTML = '';
            
            if (!renderOnly) {
                gridData = [];
            }

            for (let r = 0; r < GRID_SIZE; r++) {
                if (!renderOnly) {
                    let rowData = [];
                    for (let c = 0; c < GRID_SIZE; c++) rowData.push(false);
                    gridData.push(rowData);
                }

                for (let c = 0; c < GRID_SIZE; c++) {
                    const cell = document.createElement('div');
                    cell.classList.add('cell');
                    
                    if (renderOnly && gridData[r][c]) {
                        cell.classList.add('active');
                    }
                    
                    const index = r * 9 + c + 1;
                    const img = document.createElement('img');
                    
                    // æ³¨æ„ï¼šè¿™é‡Œå‡è®¾ä½ çš„å›¾ç‰‡æ˜¯ .png æ ¼å¼
                    // å¦‚æœæ˜¯ .jpgï¼Œè¯·æ”¹ä¸º .jpg
                    img.src = `images2/${index}.png`; 
                    img.loading = index > (GRID_SIZE * 2) ? 'lazy' : 'eager';
                    img.decoding = 'async';
                    img.width = 50;   // è®¾ç½®å®é™…æ˜¾ç¤ºå¤§å°
                    img.height = 50;

                    const numSpan = document.createElement('span');
                    numSpan.className = 'fallback-num';
                    numSpan.innerText = index;
                    numSpan.style.display = 'none'; 
                    cell.appendChild(numSpan);

                    img.onerror = function() { 
                        this.style.display = 'none'; 
                        numSpan.style.display = 'block'; 
                    };
                    cell.appendChild(img);

                    cell.addEventListener('click', () => handleClick(r, c, cell));
                    gridEl.appendChild(cell);
                }
            }
        }

        function selectMode(num, btn) {
            currentTarget = num;
            ruleText.innerText = num;
            updateModeUI(num);
            initGame(); 
        }

        function updateModeUI(targetNum) {
            document.querySelectorAll('.mode-btn').forEach(b => {
                b.classList.remove('active');
                if(parseInt(b.getAttribute('data-mode')) === targetNum) {
                    b.classList.add('active');
                }
            });
        }

        function handleClick(r, c, cell) {
            gridData[r][c] = !gridData[r][c];
            
            if (gridData[r][c]) {
                cell.classList.add('active');
            } else {
                cell.classList.remove('active');
            }
            checkWin();
        }

        function checkWin() {
            for (let r = 0; r < GRID_SIZE; r++) {
                for (let c = 0; c < GRID_SIZE; c++) {
                    if (!gridData[r][c]) continue;
                    if (checkLine(r, c, 0, 1)) return win();
                    if (checkLine(r, c, 1, 0)) return win();
                    if (checkLine(r, c, 1, 1)) return win();
                    if (checkLine(r, c, 1, -1)) return win();
                }
            }
        }

        function checkLine(r, c, dr, dc) {
            for (let k = 0; k < currentTarget; k++) {
                const nr = r + k * dr;
                const nc = c + k * dc;
                if (nr < 0 || nr >= GRID_SIZE || nc < 0 || nc >= GRID_SIZE || !gridData[nr][nc]) {
                    return false;
                }
            }
            return true;
        }

        function win() {
            setTimeout(() => { modal.style.display = 'flex'; }, 150);
        }
        function closeModal() { modal.style.display = 'none'; }

        // æ‰“å¼€å¾®ä¿¡å°ç¨‹åº - ç›´æ¥ä½¿ç”¨ä½ æä¾›çš„é“¾æ¥
        function openWeapp() {
            // ä½ æä¾›çš„è·³è½¬é“¾æ¥
            const weappUrl = "https://taix.cn/plugins/mobile/h5/mall/5489/?#/pages/index/index";
            
            // ç›´æ¥åœ¨æ–°æ ‡ç­¾é¡µæ‰“å¼€é“¾æ¥
            window.open(weappUrl, '_blank');
            
            // æˆ–è€…åœ¨å½“å‰é¡µé¢è·³è½¬
            // window.location.href = weappUrl;
        }

        function exportDoc() {
            const saveData = {
                target: currentTarget,
                grid: gridData,
                timestamp: new Date().toLocaleString()
            };
            const dataStr = JSON.stringify(saveData, null, 2);
            const blob = new Blob([dataStr], { type: "application/json" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Bingo_Save_${currentTarget}è¿_${Date.now()}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function triggerImport() { fileInput.click(); }

        function handleFileLoad(event) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    if (data.grid && data.target) {
                        gridData = data.grid;
                        currentTarget = data.target;
                        ruleText.innerText = currentTarget;
                        updateModeUI(currentTarget);
                        initGame(true); 
                        alert("å¯¼å…¥æˆåŠŸï¼");
                    } else {
                        alert("æ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®");
                    }
                } catch (error) {
                    console.error(error);
                    alert("æ— æ³•è¯»å–æ–‡ä»¶");
                }
                fileInput.value = ''; 
            };
            reader.readAsText(file);
        }

        function goHome() {
            if(confirm("ç¡®å®šè¦è¿”å›ä¸»èœå•å—ï¼Ÿ")) {
                window.location.href = "index.html";
            }
        }

        // åˆå§‹åŒ–æ¸¸æˆ
        initGame();
    </script>
</body>
</html>